MACRO(CREATELIB LIBNAME)
	STRING(REGEX MATCHALL "[A-Za-z\\./_-]+" LIBSOURCES "${LIBSOURCES}")
	STRING(REGEX MATCHALL "[A-Za-z_-]+" DEPENDENCIES "${DEPENDENCIES}")
	ADD_LIBRARY(${LIBNAME} SHARED ${LIBSOURCES})
	SET(ENV{ADDITIONAL_LIBS} "$ENV{ADDITIONAL_LIBS} ${LIBNAME}")
	TARGET_LINK_LIBRARIES(${LIBNAME} PURGE)
	FOREACH(DEPNAME ${DEPENDENCIES})
		SET(VARNAME "lib${DEPNAME}_PATH")
		FIND_LIBRARY(${VARNAME} ${DEPNAME})
		IF(${${VARNAME}} STREQUAL "${VARNAME}-NOTFOUND")
			MESSAGE(SEND_ERROR "Required library \"${DEPNAME}\" could not be found.")
		ENDIF(${${VARNAME}} STREQUAL "${VARNAME}-NOTFOUND")
		TARGET_LINK_LIBRARIES(${LIBNAME} ${DEPNAME})
		SET(ENV{ADDITIONAL_LIBS} "$ENV{ADDITIONAL_LIBS} ${DEPNAME}")
	ENDFOREACH(DEPNAME)
ENDMACRO(CREATELIB)

